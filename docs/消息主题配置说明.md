消息主题配置说明
================

> + 文档版本 v1.0
> + 韩正扬 2020-03-12

# 0.统一说明
## 1.主题格式

消息主题格式为分隔符分割的，若干主题片段连接的字符串。
格式大体如下：
```
/sys/workflow/{version}/{area}/{biz}
```
其中：
1. 分隔符为`/`
2. `{xxx}`表示参数化内容，根据不同的环境、场景、版本，可能会有不同的值

## 2.消息主题映射

项目中，消息中间件适配器订阅的消息通过消息主题映射变换为内部消息主题。
代码中使用相对固定的主题来处理不同业务。

同时，内部产生的消息，同样通过主题映射变换后通过消息中间件适配器发布到外部。


# 1.工单消息

## 1.1.外部主题格式
外部主题（消息中间件）格式：`/sys/workflow/{version}/{area}/{biz}/{...}`

分隔符为`/`，主题参数包括：
+ `{version}`目前为`v1`
+ `{area}`目前为`GLOBAL`
+ `{biz}`
    1. 开发环境为`dev`
    2. 测试环境为`demo`
    3. 生产环境为`product`
+ `{...}`为工单业务下各个业务消息类型，根据实际情况自行设定

## 1.2.内部主题格式
内部主题格式：`/workflow/{...}`

其中，`{...}`为业务类型。


# 2.井卫消息

## 2.1.外部主题格式
外部主题（消息中间件）格式：`/sys/cover-guard/{version}/{area}/{biz}/{...}`

分隔符为`/`，主题参数包括：
+ `version`目前为`v1`
+ `area`目前为`GLOBAL`
+ `biz`
    1. 开发环境为`dev`
    2. 测试环境为`demo`
    3. 生产环境为`product`
+ `...`为工单业务下各个业务消息类型，根据实际情况自行设定

## 2.2.内部主题格式
内部主题格式：`/workflow/{...}`

其中，`{...}`为业务类型。


# 3.配置项

以下为生产环境的相关配置
```
# 订阅消息中间件主题
mq.topic.prefix=/sys/workflow/v1/GLOBAL/COMMON,/sys/cover-guard/v1/GLOBAL/COMMON

# 消息主题映射
message.topic.mapping=/sys/workflow/v1/GLOBAL/COMMON,/workflow;/sys/cover-guard/v1/GLOBAL/COMMON,/guard
```
